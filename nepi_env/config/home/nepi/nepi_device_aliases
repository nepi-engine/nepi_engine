#############
# SETUP
# SETUP Aliases
# 1) Copy nepi_env/config/home/nepi/nepi_device_aliases to /mnt/nepi_storage/tmp
# 2) SSH into your nepi device and type
# cp /mnt/nepi_storage/tmp/nepi_device_aliases ~/.nepi_aliases
# source ~/.nepi_aliases

# Update bashrc
# 1) Copy nepi_env/config/home/nepi/bashrc_NVIDIA_JETSON to /mnt/nepi_storage/tmp
# 2) SSH into your nepi device and type
# cp /mnt/nepi_storage/tmp/bashrc_NVIDIA_JETSON ~/.bashrc
# source ~/.bashrc


###################################
#Dev Shortcuts
# Function to search for text
# Example call: find 'nepi_sdk.parse_header_msg'
function ftext(){
grep -r "$@" ./*
}

# Function to search for text
# Example call: find 'nepi_sdk.parse_header_msg'
function ffile(){
find ./* -iname  "*$@*" 
}

# Function to search for topic containing string
function ftopic(){
rostopic list | grep "$@" 
}

# Function to print all topics out
function ftopics(){
rostopic list
}

# Function to listen to topic
function ctopic(){
rostopic echo "$@" 
}

# Function to search for service containing string
function fservice(){
rosservice list | grep "$@" 
}

# Function to print all services out
function fservices(){
rosservice list
}

# to call service
function cservice(){
rosservice call "$@"
}



###################################
#NEPI folder shortcuts
export AI="/mnt/nepi_storage/ai_models"
export AIF="/opt/nepi/ros/share/nepi_ai_ifs"
export API="/opt/nepi/ros/lib/python3/dist-packages/nepi_api"
export APPS="/opt/nepi/ros/share/nepi_apps"
export AUTO="/mnt/nepi_storage/automation_scripts"
export CFG="/mnt/nepi_storage/user_cfg"
export AUTO="/mnt/nepi_storage/automation_scripts"
export DATA="/mnt/nepi_storage/data"
export DIST="/opt/nepi/ros/lib/python3/dist-packages"
export DRIVERS="/opt/nepi/ros/lib/nepi_drivers"
export ETC="/opt/nepi/ros/etc"
export INSTALLS="/mnt/nepi_storage/installs"
export LAUNCH="/opt/nepi/ros/share/nepi_env/launch"
export LIB="/opt/nepi/ros/lib"
export LIBSDK="/opt/nepi/ros/lib/nepi_sdk"
export MANAGERS="/opt/nepi/ros/lib/nepi_managers"
export NFI="/mnt/nepi_storage/nepi_full_img"
export NFIA="/mnt/nepi_storage/nepi_full_img_archive"
export ROS="/opt/nepi/ros"
export RUI="/opt/nepi/nepi_rui/src/rui_webserver/rui-app/src"
export RUI_ENV="/opt/nepi/nepi_rui"
export SDK="/opt/nepi/ros/lib/python3/dist-packages/nepi_sdk"
export SHARE="/opt/nepi/ros/share"
export SRC="/mnt/nepi_storage/nepi_src/nepi_engine_ws/src"
export TMP="/mnt/nepi_storage/tmp"
export TRAIN="/mnt/nepi_storage/ai_training"
export DRIVE="/mnt/nepi_storage"

# NEPI navigation shortcuts

alias ai="cd $AI"
alias aif="cd $AIF"
alias api="cd $API"
alias apps="cd $APPS"
alias auto="cd $AUTO"
alias cfg="cd $CFG"
alias data="cd $DATA"
alias dist="cd $DIST"
alias drivers="cd $DRIVERS"
alias etc="cd $ETC"
alias installs="cd $INSTALLS"
alias launch="cd $LAUNCH"
alias lib="cd $LIB"
alias libsdk="cd $LIBSDK"
alias managers="cd $MANAGERS"
alias nfi="cd $NFI"
alias nfia="cd $NFIA"
alias ros="cd $ROS"
alias rui="cd $RUI"
alias rui_env="cd $RUI_ENV"
alias sdk="cd $SDK"
alias share="cd $SHARE"
alias src="cd $SRC"
alias tmp="cd $TMP"
alias train="cd $TRAIN"
alias drive="cd $DRIVE"


# NEPI build shortcuts
alias nepibld="
cd $SRC/..
./build_nepi_complete.sh"

# NEPI build shortcuts
alias codebld="
cd $SRC/..
./build_nepi_code.sh"

# NEPI build shortcuts
alias ruibld="
cd $SRC/..
./build_nepi_rui.sh"

# NEPI stop and start shortcuts
alias nepistop="sudo systemctl stop roslaunch"
alias nepistart="sudo /opt/nepi/ros/etc/nepi_env/roslaunch.sh"


# NEPI ros stop and start shortcuts
alias rosstop="sudo systemctl stop roslaunch"
alias rosstart="sudo /opt/nepi/ros/etc/nepi_env/roslaunch.sh"


# Print out the nepi shortcuts
function nepi(){
    text="
    #############################
    ## NEPI function shortcuts ##
    #############################
    # ftext = Find text in files recursively
    # ffile = Find filenames with text match recursively
    # ftopics = List all active topics
    # ftopic = Find topics containing provided string
    # ctopic = Listen to provided topic
    # fservices = List all active services
    # fservice = Find services containing provided string
    # cservice = Call service
    #
    #############################
    ## NEPI run shortcuts ##
    #############################
    # nepibld = build/deploy all nepi repos and RUI
    # codebld = build/deploy all nepi repos
    # ruibld = build/deploy rui system
    #
    #############################
    ## NEPI run shortcuts ##
    #############################
    # nepistart = start the nepi processes
    # nepistop = stop the nepi processes
    #
    ################################
    ## NEPI folder shortcuts ##
    ################################
    ai = /mnt/nepi_storage/ai_models
    aifs = /opt/nepi/ros/share/nepi_aifs
    api = /opt/nepi/ros/lib/python3/dist-packages/nepi_api
    apps = /opt/nepi/ros/share/nepi_apps
    auto = /mnt/nepi_storage/automation_scripts
    cfg = /mnt/nepi_storage/user_cfg
    data = /mnt/nepi_storage/data
    dist = /opt/nepi/ros/lib/python3/dist-packages/
    drivers = /opt/nepi/ros/lib/nepi_drivers
    etc = /opt/nepi/ros/etc
    installs = /mnt/nepi_storage/installs
    lib = /opt/nepi/ros/lib
    libsdk = /opt/nepi/ros/lib/nepi_sdk
    managers = /opt/nepi/ros/lib/nepi_managers
    ros = /opt/nepi/ros
    nfi = /mnt/nepi_storage/nepi_full_img
    nfia = /mnt/nepi_storage/nepi_full_img_archive
    rui = /opt/nepi/nepi_rui/src/rui_webserver/rui-app/src
    rui_env = /opt/nepi/nepi_rui
    sdk = /opt/nepi/ros/lib/python3/dist-packages/nepi_sdk
    share = /opt/nepi/ros/share
    src = /mnt/nepi_storage/nepi_src/nepi_engine_ws/src
    tmp = /mnt/nepi_storage/tmp
    train = /mnt/nepi_storage/ai_training
    drive = /mnt/nepi_storage
    "
    echo "$text"
}

# Inform that this is the target hardware
export NEPI_REMOTE_SETUP=0

# CUDA Helpers (Open3D, etc)
export CUDA_HOME=/usr/local/cuda-11
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CUDA_HOME/bin/lib64:$CUDA_HOME/bin/extras/CUPTI/lib64
export PATH=$PATH:$CUDA_HOME/bin

export PYTHONPATH=$PYTHONPATH:/opt/nepi/ros/lib/nepi_drivers
