<launch>
  <arg name="global_ns" value="$(env ROOTNAME)" />
  <arg name="device_ns" value="$(env ROOTNAME)/$(env DEVICE_ID)" />
  <arg name="output_destination" value="screen" />
  <arg name="config_file_root" value="/opt/nepi/nepi_engine/etc" />
  <arg name="partition_layout_file" default="s2x_xavier_nx_nepi_partition_layout.yaml" />

  <!-- Args. to run or not run specific nodes -->
  <arg name="run_robot_state_publisher" default="false" />
  <arg name="run_web_utils" default="true" />

  <arg name="run_mgr_network" default="true" />
  <arg name="run_mgr_time" default="true" />
  <arg name="run_mgr_navpose" default="true" />
  <arg name="run_mgr_ai_models" default="true" />
  <arg name="run_mgr_targets" default="false" />
  <arg name="run_mgr_drivers" default="true" />
  <arg name="run_mgr_apps" default="true" />
  <arg name="run_mgr_scripts" default="true" />
  <arg name="run_mgr_software" default="true" />

        
  <!-- Everything lives in the device namespace -->
  <group ns="$(arg device_ns)">


    <rosparam command="load" file="$(arg config_file_root)/system_mgr.yaml" ns="system_mgr" />

    <node name="system_mgr" pkg="nepi_managers" type="system_mgr.py" respawn="false" output="$(arg output_destination)" />

    <node name="config_mgr" pkg="nepi_managers" type="config_mgr.py" respawn="false" output="$(arg output_destination)" />

    <node if="$(arg run_robot_state_publisher)" name="nepi_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" output="screen" required="true" />


    <group if="$(arg run_web_utils)" >
      <!-- Rosbridge_websocket (for RUI or stand-alone)-->
      <include file="$(find rosbridge_server)/launch/rosbridge_websocket.launch" >
        <arg name="address" value="0.0.0.0"/>
        <arg name="port" value="9090"/>
        <!-- Use a long unregister_timeout as a work-around for the well-known unregister rospy bug -->
        <arg name="unregister_timeout" value="31536000"/>
      </include>

      <!-- Web Video Server (for RUI or stand-alone) -->
      <node name="web_video_server" pkg="web_video_server" type="web_video_server" output="$(arg output_destination)">
        <param name="port" value="9091"/>
      </node>
    </group>

    <!-- MGR:  Network -->
    <group if="$(arg run_mgr_network)" >
    <rosparam command="load" file="$(arg config_file_root)/network_mgr.yaml" ns="network_mgr" />
    <node name="network_mgr" pkg="nepi_managers" type="network_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group> 

    <!-- MGR:  Time Sync -->
    <group if="$(arg run_mgr_time)" >
    <rosparam command="load" file="$(arg config_file_root)/time_mgr.yaml" ns="time_mgr" />
    <node name="time_mgr" pkg="nepi_managers" type="time_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group> 

    <!-- MGR:  NavPose -->
    <group if="$(arg run_mgr_navpose)" >
      <!-- Nav/Pose Mgr -->
      <rosparam command="load" file="$(arg config_file_root)/navpose_mgr.yaml" ns="navpose_mgr" />
      <node name="navpose_mgr" pkg="nepi_managers" type="navpose_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>      
 
 <!-- MGR: AI Model Mgr -->
    <group if="$(arg run_mgr_ai_models)" >
      <rosparam command="load" file="$(arg config_file_root)/ai_model_mgr.yaml" ns="ai_model_mgr" />
      <node name="ai_model_mgr" pkg="nepi_managers" type="ai_model_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>

 <!-- MGR: Targets Mgr -->
    <group if="$(arg run_mgr_targets)" >
      <rosparam command="load" file="$(arg config_file_root)/targets_mgr.yaml" ns="targets_mgr" />
      <node name="targets_mgr" pkg="nepi_managers" type="targets_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>

   <!-- MGR: Drivers -->
    <group if="$(arg run_mgr_drivers)" >
      <rosparam command="load" file="$(arg config_file_root)/drivers_mgr.yaml" ns="drivers_mgr" />
      <node name="drivers_mgr" pkg="nepi_managers" type="drivers_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>
    
   <!-- MGR: Apps -->
    <group if="$(arg run_mgr_apps)" >
      <rosparam command="load" file="$(arg config_file_root)/apps_mgr.yaml" ns="apps_mgr" />
      <node name="apps_mgr" pkg="nepi_managers" type="apps_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>


       <!-- MGR: Automation -->
    <group if="$(arg run_mgr_scripts)" >
      <rosparam command="load" file="$(arg config_file_root)/scripts_mgr.yaml" ns="scripts_mgr" />
      <node name="scripts_mgr" pkg="nepi_managers" type="scripts_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>

    <!-- MGR: Automation -->
    <group if="$(arg run_mgr_software)" >
      <rosparam command="load" file="$(arg config_file_root)/software_mgr.yaml" ns="software_mgr" />
      <node name="software_mgr" pkg="nepi_managers" type="software_mgr.py" respawn="false" output="$(arg output_destination)" />
    </group>


  </group>

</launch>
